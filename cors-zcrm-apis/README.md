# CORS for Zoho CRM APIs using ZCRM JS SDK

## Table Of Contents

* [Overview](#overview)
* [CORS](#CORS)
* [Steps to work with JS SDK ](#steps-to-work-with-js-sdk)

## Overview

Zoho CRM offers ZCRM JS SDK which enables access and use of `CORS` enabled CRM APIs. ZCRM JS SDK acts as a middleware between Zoho CRM and your JS application by enabling the CORS headers for the HTTP requests generated by the registered Client Based OAuth Applications.

## CORS

[Cross-origin resource sharing (CORS)](https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS) is a browser security feature that restricts cross-origin HTTP requests initiated from scripts running in a browser. A cross-origin HTTP request is a request that is made to a different domain, sub-domain, port or protocol. When non-simple HTTP requests are fired to a REST resource, CORS support needs to be enabled on that end point.

There are two types of cross-origin HTTP requests :

- Simple requests
- Non-Simple requests.

## Simple HTTP Requests:
A simple request is a request that meets the below criteria.

- The request should use one of these methods **GET, HEAD, POST.**
- The headers allowed to be manually set (other than headers automatically set by the user agent) are Accept, Accept-Language, Content-Language and Content-Type.
- The Content-Type header in the above criteria can only have the type/subtype as application/x-www-form-urlencoded, multipart/form-data and text/plain No.
- ReadableStream object is not allowed in the request.
- No event listeners are registered on the object returned by XMLHttpRequest.upload 

These requests will not trigger a CORS pre-flight. A pre-flight request is a CORS OPTIONS request that checks to see if the CORS protocol is understood and a server is aware using specific methods and headers.

For simple requests, the browser sends the header ORIGIN in the XMLHttpRequest to inform the target site about the request's origin. On the target site, the server compares the ORIGIN value with the allowed origins.If the source is allowed, the target site allows access to the resource to the requested site. Otherwise, the request is denied. All other cross-origin HTTP requests are non-simple requests. If your API's resources receive non-simple requests, you need to enable CORS support.

## Non-Simple HTTP Requests:
Before the actual request is sent, a pre-flight request is sent to the target site. The browser sends the pre-flight request via the OPTIONS HTTP request method. The server sends the details about the target site such as the allowed methods and the allowed origins. After deciding whether the target site could return the information, the browser makes the actual GET/POST/PUT/DELETE request.

## Steps to work with ZCRM JS SDK 

Please follow the below steps to work with JS SDK to enable CORS headers for your application.

Step 1: Register your [OAuth2.0 app](https://www.zoho.com/accounts/protocol/oauth.html) as [Client-based Application](https://www.zoho.com/accounts/protocol/oauth/javascript-applications.html) in ZOho CRM.

Step 2: Include the `CRM's JS SDK CDN url`` in your HTML pages.

```js 
script src="https://static.zohocdn.com/zohocrm/v2.0/sdk/3.0.0/sdk.js"
```

Step 3: Initialize the SDK. Refer this [link](https://www.zoho.com/crm/developer/docs/javascript-sdk/initialize.html) for more initialization options.

```js
let logger = Logger.getInstance(Levels.ALL);
let environment = DataCenter.US.PRODUCTION();

let token = new OAuthBuilder()
	.clientId("1000.xxxxxx")
	.scope("ZohoCRM.modules.ALL,ZohoCRM.settings.ALL")
	.redirectURL("http://127.0.0.1:5501/redirect.html")
	.build();
let sdkConfig = new SDKConfigBuilder()
	.autoRefreshFields(true)
	.cacheStore(true)
	.pickListValidation(false).build();

(await new InitializeBuilder())
	.environment(environment)
	.token(token)
	.initialize();
```

Step 4: Handle OAuth2.0 Redirection handling. This is the html where the user will be redirected after the OAuth2.0 Authentication consent page.The script is available on this [page](https://www.zoho.com/crm/developer/docs/javascript-sdk/usingjssdk.html).
This places the token in the local Storage of the browser window, which will be transferred to the session Storage later by our JS SDK.

Step 5: Invoke CRM's API from JS SDK. Sample codes can be referred [here](https://www.zoho.com/crm/developer/docs/javascript-sdk/sample-codes.html).

```js
let contactRolesOperations = new ZCRM.ContactRole.Operations();
let response = await contactRolesOperations.getContactRoles();

if(response != null) {
	//Get the status code from response
	console.log("Status Code: " + response.getStatusCode());
}
```

    
